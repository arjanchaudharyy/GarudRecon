#!/bin/bash

# Default config file path
source "configuration/garudrecon.cfg"

# Help function
function show_help() {
  cat <<EOF
GarudRecon - Recon Automation Framework

GarudRecon is an automated reconnaissance framework designed for asset discovery,
vulnerability detection, and continuous monitoring. It leverages a wide range of
open-source tools to scan domains, collect subdomains, and check for various
vulnerabilities such as:

  • XSS (Cross-Site Scripting)
  • SQLi (SQL Injection)
  • LFI (Local File Inclusion)
  • RCE (Remote Code Execution)
  • IIS misconfigurations
  • Subdomain Takeover
  • Open Redirects
  • Swagger UI exposures
  • .git directory leaks
  • JavaScript secrets and more.

The tool supports scoped recon with flexible modes like smallscope, mediumscope,
and largescope, depending on your coverage needs. You can customize scans,
exclude specific functions, provide configuration files, and automate cron jobs
for continuous monitoring.

Usage:
  garudrecon [command]

Available Commands:
  web                     Start the web interface (recommended for beginners)
  install                 Set up the tool and dependencies
  smallscope              Run minimal recon for subdomain (e.g. support.domain.com)
  mediumscope             Perform moderate recon with optional vulnerability checks for wildcard domain (e.g. *.domain.com)
  largescope              Full-scale recon for deep visibility for organisation
  cronjobs                Automate recurring recon tasks continuously

Flags:
  -h, --help     help for garudrecon
  -v, --version  Display the current version

Use "garudrecon [command] --help" for more information about a command.
EOF
}

# Check if no args
if [[ $# -eq 0 ]]; then
  show_help
  exit 0
fi

COMMAND=$1
shift

case "$COMMAND" in
  web)
    bash "$(dirname "$0")/start_web.sh"
    ;;
  install)
    bash "$(dirname "$0")/cmd/install" "$@"
    ;;
  smallscope)
    bash "$(dirname "$0")/cmd/smallscope" "$@"
    ;;
  mediumscope)
    bash "$(dirname "$0")/cmd/mediumscope" "$@"
    ;;
  largescope)
    bash "$(dirname "$0")/cmd/largescope" "$@"
    ;;
  cronjobs)
    bash "$(dirname "$0")/cmd/cronjobs" "$@"
    ;;
  -v|--version)
    echo "GarudRecon version: $VERSION"
    ;;
  -h|--help)
    show_help
    ;;
  *)
    echo "Unknown command: $COMMAND"
    echo "Use 'garudrecon --help' for usage."
    exit 1
    ;;
esac
